<link rel="stylesheet" href="/css/public/cart.css">

<div class="cart">
    <div class="container">
        <div class="cart-title">
            Giỏ hàng
        </div>
        <div id="cart-empty" class="d-none">
            <div class="d-flex align-items-center flex-column mt-4">
                <div>
                    Quý khách chưa đặt món ăn nào cả.
                </div>
                <div class="">
                    Nhấn vào <a href="/menu">đây</a> để chọn món nào.
                </div>
            </div>
        </div>
        <div id="cart-not-empty" class="row mt-5">
            <div class="col-12 col-lg-8">
                <ul class="cart-list">
                    <li class="cart-item d-flex align-items-md-center">
                        <img src="/images/food/lau1.jpg" alt="Img" class="cart-item__img">
                        <div class="cart-item__wrapper d-flex flex-column flex-md-row align-items-md-center">
                            <div class="cart-item__info">
                                <div class="cart-item__name">Lẩu thái</div>
                                <div><span class="cart-item__price">300.000</span>đ
                                </div>
                            </div>
                            <div class="cart-item__control">
                                <button class="cart-item__btn cart-item__btn--decrease">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <input type="number" class="cart-item__num" value="1">
                                <button class="cart-item__btn cart-item__btn--increase">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <div class="d-none d-md-block mx-2 cart-item__wrap">
                                Tổng tiền: <span class="cart-item__total">300.000</span>đ
                            </div>
                        </div>
                        <i class="cart-item__delete fas fa-times" onClick="handleDelete(this)"></i>
                    </li>
                    <li class="cart-item d-flex align-items-md-center">
                        <img src="/images/food/lau2.jpg" alt="Img" class="cart-item__img">
                        <div class="cart-item__wrapper d-flex flex-column flex-md-row align-items-md-center">
                            <div class="cart-item__info">
                                <div class="cart-item__name">Lẩu cua đồng</div>
                                <div><span class="cart-item__price">300.000</span>đ
                                </div>
                            </div>
                            <div class="cart-item__control">
                                <button class="cart-item__btn cart-item__btn--decrease">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <input type="number" class="cart-item__num" value="1">
                                <button class="cart-item__btn cart-item__btn--increase">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <div class="d-none d-md-block mx-2 cart-item__wrap">
                                Tổng tiền: <span class="cart-item__total">300.000</span>đ
                            </div>
                        </div>
                        <i class="cart-item__delete fas fa-times" onClick="handleDelete(this)"></i>
                    </li>
                    <li class="cart-item d-flex align-items-md-center">
                        <img src="/images/food/lau3.jpg" alt="Img" class="cart-item__img">
                        <div class="cart-item__wrapper d-flex flex-column flex-md-row align-items-md-center">
                            <div class="cart-item__info">
                                <div class="cart-item__name">Lẩu dê</div>
                                <div><span class="cart-item__price">200.000</span>đ
                                </div>
                            </div>
                            <div class="cart-item__control">
                                <button class="cart-item__btn cart-item__btn--decrease">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <input type="number" class="cart-item__num" value="1">
                                <button class="cart-item__btn cart-item__btn--increase">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <div class="d-none d-md-block mx-2 cart-item__wrap">
                                Tổng tiền: <span class="cart-item__total">200.000</span>đ
                            </div>
                        </div>
                        <i class="cart-item__delete fas fa-times" onClick="handleDelete(this)"></i>
                    </li>
                    <li class="cart-item d-flex align-items-md-center">
                        <img src="/images/food/lau4.jpg" alt="Img" class="cart-item__img">
                        <div class="cart-item__wrapper d-flex flex-column flex-md-row align-items-md-center">
                            <div class="cart-item__info">
                                <div class="cart-item__name">Lẩu bò</div>
                                <div><span class="cart-item__price">300.000</span>đ
                                </div>
                            </div>
                            <div class="cart-item__control">
                                <button class="cart-item__btn cart-item__btn--decrease">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <input type="number" class="cart-item__num" value="1">
                                <button class="cart-item__btn cart-item__btn--increase">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <div class="d-none d-md-block mx-2 cart-item__wrap">
                                Tổng tiền: <span class="cart-item__total">300.000</span>đ
                            </div>
                        </div>
                        <i class="cart-item__delete fas fa-times" onClick="handleDelete(this)"></i>
                    </li>
                </ul>
                <div class="d-flex justify-content-end my-2">
                    <button class="cart-add btn btn-danger">Thêm món</button>
                </div>
            </div>
            <div class="col-12 col-lg-4">
                <textarea class="cart-note" rows="4" placeholder="Ghi chú..."></textarea>
                <div class="d-xl-block mt-3"></div>
                <div class="cart-total">
                    Tổng tiền: <span class="cart-total__cash">0đ</span>
                </div>
                <a href="/checkouts" type="button" class="cart-order btn btn-success w-100 mt-3">Đặt ship</a>
                <div class="mt-2 text-info">
                    *Đơn từ 1.000.000đ trở lên sẽ được freeship
                </div>
            </div>
        </div>
    </div>
</div>
{{!--
<script>
    let totalCash = 0;

    $(document).ready(function () {
        if (Object.keys(cartList["foods"]).length > 0) {
            $('#cart-empty').addClass('d-none');
            $('#cart-not-empty').removeClass('d-none');

            Object.keys(cartList["foods"]).forEach(foodID => {
                const foodQuantity = cartList["foods"][foodID];

                $.ajax({
                    async: false,
                    type: 'GET',
                    url: `../api/get_food.php?foodID=${foodID}`,
                    success: function (data) {
                        const foodName = data.name;
                        const foodImage = data.image;
                        const foodPrice = data.price
                        const totalPrice = foodPrice * foodQuantity;

                        totalCash = totalCash + totalPrice;

                        $('.cart-list').append(`
                        <li class="cart-item d-flex align-items-md-center" data-food-id=${foodID} data-food-total=${totalPrice} data-food-price=${foodPrice}>
                            <img src="../api/food-images/${foodImage}" alt="Img" class="cart-item__img">
                            <div class="cart-item__wrapper d-flex flex-column flex-md-row align-items-md-center">
                                <div class="cart-item__info">
                                    <div class="cart-item__name">${foodName}</div>
                                    <div><span class="cart-item__price">${Intl.NumberFormat('vi-VN').format(foodPrice)}</span>đ</div>
                                </div>
                                <div class="cart-item__control">
                                    <button class="cart-item__btn cart-item__btn--decrease" onClick="handleDecrease(this)">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <input type="number" class="cart-item__num" value="${foodQuantity}" onChange="handleInputChange(this)">
                                    <button class="cart-item__btn cart-item__btn--increase" onClick="handleIncrease(this)">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div class="d-none d-md-block mx-2 cart-item__wrap">
                                    Tổng tiền: <span class="cart-item__total">${Intl.NumberFormat('vi-VN').format(totalPrice)}</span>đ
                                </div>
                            </div>
                            <i class="cart-item__delete fas fa-times" onClick="handleDelete(this)"></i>
                        </li>
                    `);
                    }
                });
            })

            // Set tổng tiền
            updateCartTotalCash();

            $(".cart-note").val(cartList["message"]);
        } else {
            $('#cart-empty').removeClass('d-none');
            $('#cart-not-empty').addClass('d-none');
        }

    })

    function updateCartTotalCash() {
        $('.cart-total__cash').html(`${Intl.NumberFormat('vi-VN').format(totalCash)}đ`);
    }

    function handleDelete(e) {
        const cartItemElement = $(e).closest('.cart-item');
        const foodID = cartItemElement.attr('data-food-id');
        const foodTotalPrice = cartItemElement.attr('data-food-total');
        cartItemElement.remove();

        delete cartList["foods"][foodID];

        // Kiểm tra, nếu không còn món nào thì hiện phần empty cart list
        if (Object.keys(cartList["foods"]).length === 0) {
            $('#cart-empty').removeClass('d-none');
            $('#cart-not-empty').addClass('d-none');
            cartList["message"] = "";
            window.localStorage.setItem("com_nha_cart", JSON.stringify(cartList));
        }

        // Trừ đi số tiền món ăn
        totalCash = totalCash - parseInt(foodTotalPrice);
        updateCartTotalCash();

        // Lưu giá trị mới vào bộ nhớ cục bộ
        window.localStorage.setItem("com_nha_cart", JSON.stringify(cartList));

        // Cập nhật lại số món ăn trong giỏ hàng
        updateCartNumber();
    }

    // Bắt sự kiện ghi chú
    $('.cart-note').change(function () {
        cartList["message"] = $(this).val();
        window.localStorage.setItem("com_nha_cart", JSON.stringify(cartList));
    })

    // Bắt sự kiện nút Thêm món
    $('.cart-add').click(function () {
        window.location.href = "/menu";
    })

    // Cập nhật lại thông tin của item cart
    function updateCartItem(cartItemElement, type, quantity) {
        const cartItemTotalElement = cartItemElement.find('.cart-item__total');
        const cartItemNumElement = cartItemElement.find('.cart-item__num');

        const foodID = cartItemElement.attr('data-food-id');
        const foodPrice = parseInt(cartItemElement.attr('data-food-price'));
        const foodQuantity = parseInt(cartList["foods"][foodID]);

        let newQuantiry = 0;
        if (type === "add") {
            newQuantiry = foodQuantity + 1;
        } else if (type === "sub") {
            newQuantiry = foodQuantity - 1;
        } else if (type === "custom") {
            newQuantiry = quantity;
        }

        if (newQuantiry !== 0) {
            if (type === "add") {
                totalCash = totalCash + foodPrice;
            } else if (type === "sub") {
                totalCash = totalCash - foodPrice;
            } else if (type === "custom") {
                totalCash = totalCash - (foodPrice * foodQuantity);
                totalCash = totalCash + (foodPrice * newQuantiry);
            }

            // Cập nhật lại các số liệu của cart item:
            cartItemNumElement.val(newQuantiry); // Số lượng
            cartItemTotalElement.html(Intl.NumberFormat('vi-VN').format(foodPrice * newQuantiry)); // Tổng tiền của món ăn
            cartItemElement.attr('data-food-total', foodPrice * newQuantiry); // Set lại attr tổng tiền của thẻ

            // Cập nhật lại tổng tiền trong giỏ hàng
            updateCartTotalCash();

            // Cập nhật lại số lượng của món ăn trong localStorage
            cartList["foods"][foodID] = newQuantiry;
            window.localStorage.setItem('com_nha_cart', JSON.stringify(cartList));

            // Cập nhật số lượng món ăn trên giỏ hàng
            updateCartNumber();
        }
    }

    // Nhấn nút giảm số lượng => Chỉ được giảm tới số 1
    function handleDecrease(e) {
        const cartItemElement = $(e).closest('.cart-item');
        updateCartItem(cartItemElement, "sub");
    }

    // Nhấn nút tăng số lượng
    function handleIncrease(e) {
        const cartItemElement = $(e).closest('.cart-item');
        updateCartItem(cartItemElement, "add");
    }

    // Bắt sự kiện các ô input được thay đổi
    function handleInputChange(e) {
        const cartItemElement = $(e).closest('.cart-item');
        let value = parseInt($(e).val());
        if (value < 1) {
            value = 1;
        }
        updateCartItem(cartItemElement, "custom", value);
    }
</script> --}}